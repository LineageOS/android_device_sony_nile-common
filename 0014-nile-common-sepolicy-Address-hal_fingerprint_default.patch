From b44ca3d7afec8ffe33ee1412f702ca6e55ba9aea Mon Sep 17 00:00:00 2001
From: LuK1337 <priv.luk@gmail.com>
Date: Tue, 4 Sep 2018 16:54:51 +0200
Subject: [PATCH 14/35] nile-common: sepolicy: Address hal_fingerprint_default
 denials

Change-Id: If0218356eedc43f53d180c2415c777c2b7f8bf10
---
 sepolicy/vendor/file_contexts              | 1 +
 sepolicy/vendor/hal_fingerprint_default.te | 4 ++++
 sepolicy/vendor/tee.te                     | 3 +++
 3 files changed, 8 insertions(+)
 create mode 100644 sepolicy/vendor/tee.te

diff --git a/sepolicy/vendor/file_contexts b/sepolicy/vendor/file_contexts
index 6462c5b..d54d716 100644
--- a/sepolicy/vendor/file_contexts
+++ b/sepolicy/vendor/file_contexts
@@ -10,6 +10,7 @@
 
 # Sys files
 /sys/class/qns(/.*)?                                                                    u:object_r:qns_sysfs:s0
+/sys/devices/soc/soc:egistec(/.*)?                                                      u:object_r:sysfs_fpc:s0
 /sys/devices/soc/soc:fpc1020(/.*)?                                                      u:object_r:sysfs_fpc:s0
 /sys/devices(/platform)?/soc/[a-z0-9]+\.qcom,jpeg/video4linux/video[0-9]+/name(/.*)?    u:object_r:sysfs_graphics:s0
 /sys/kernel/boot_wlan(/.*)?                                                             u:object_r:sysfs_wifi:s0
diff --git a/sepolicy/vendor/hal_fingerprint_default.te b/sepolicy/vendor/hal_fingerprint_default.te
index 976766c..ae60e04 100644
--- a/sepolicy/vendor/hal_fingerprint_default.te
+++ b/sepolicy/vendor/hal_fingerprint_default.te
@@ -16,6 +16,10 @@ allow hal_fingerprint_default etsd_device:chr_file rw_file_perms;
 # Allow hal_fingerprint_default to read and write to tee_device
 allow hal_fingerprint_default tee_device:chr_file rw_file_perms;
 
+# Allow hal_fingerprint_default to read, write and create files in fingerprintd_data_file
+allow hal_fingerprint_default fingerprintd_data_file:file create_file_perms;
+allow hal_fingerprint_default fingerprintd_data_file:dir rw_dir_perms;
+
 # Allow hal_fingerprint_default to read and write to sysfs_fpc
 allow hal_fingerprint_default sysfs_fpc:dir r_dir_perms;
 allow hal_fingerprint_default sysfs_fpc:file rw_file_perms;
diff --git a/sepolicy/vendor/tee.te b/sepolicy/vendor/tee.te
new file mode 100644
index 0000000..b2c2f13
--- /dev/null
+++ b/sepolicy/vendor/tee.te
@@ -0,0 +1,3 @@
+# Allow tee to read, write and create files in fingerprintd_data_file
+allow tee fingerprintd_data_file:dir rw_dir_perms;
+allow tee fingerprintd_data_file:file create_file_perms;
-- 
2.17.1

